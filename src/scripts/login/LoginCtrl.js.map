{
  "version": 3,
  "file": "LoginCtrl.js",
  "sourceRoot": "",
  "sources": [
    "LoginCtrl.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "'use strict'\n\nangular.module('myvcFrontApp')\n.controller('LoginCtrl', ['$scope', '$rootScope', 'AUTH_EVENTS', 'AuthService', '$location', '$cookies', 'Perfil', 'App', '$http', 'toastr', '$sce', ($scope, $rootScope, AUTH_EVENTS, AuthService, $location, $cookies, Perfil, App, $http, toastr, $sce)->\n\n  animation_speed         = 300\n  $scope.logueando        = true\n  $scope.recuperando      = false\n  $scope.registrando      = false\n  $scope.perfilPath       = App.images+'perfil/'\n\n\n  # Si el colegio quiere que aparezca su imagen en el encabezado, puede hacerlo.\n  $scope.logoPathDefault = 'images/Logo_MyVc_Header.gif'\n  $scope.logoPath = 'images/Logo_Colegio_Header.gif'\n  #$scope.paramuser = {'username': Perfil.User().username }\n\n\n  $scope.verPublicacionDetalle = ()->\n    toastr.info 'Debes loguearte para ver más detalles.'\n\n  $http.get($scope.logoPath).then(()->\n    console.log('imagen existe')\n  , ()->\n    #alert('image not exist')\n    $scope.logoPath = $scope.logoPathDefault # set default image\n  )\n\n\n  $scope.abrirImagenBlank = (ruta)->\n    window.open(ruta, '_blank');\n\n\n  $scope.ir_prematricular = ()->\n    $scope.mostrando_prematricular = !$scope.mostrando_prematricular\n    if $scope.mostrando_prematricular\n      $scope.estilo_login = 'height: 600px !important;';\n    else\n      $scope.estilo_login = '';\n\n\n\n  $scope.guardar_prematricula = ()->\n    $scope.guardando = true\n    cre = $scope.credentials\n\n    if cre.nombres.length and cre.apellidos.length and cre.celular.length and cre.documento.length\n\n      cre.estado    = 'PREA'\n      cre.nuevo     = 1\n      cre.year      = $scope.year.year+1\n      cre.grupo_id  = $scope.year.grupo_prematr.id\n\n      $http.put('::login/crear-prematricula', cre).then((r)->\n        toastr.success r.data.estado\n\n        $scope.credentials =\n          username: ''\n          password: ''\n          sexo: 'M'\n          nombres: ''\n          apellidos: ''\n          celular: ''\n          documento: ''\n\n        $scope.ir_prematricular()\n\n      , ()->\n        #alert('image not exist')\n        $scope.logoPath = $scope.logoPathDefault # set default image\n      )\n\n\n    else\n      toastr.error 'Faltan datos, por favor escíbelos todos.'\n\n\n\n\n  $http.put('::publicaciones/ultimas').then((r)->\n    $scope.publicaciones  = r.data.publicaciones\n    $scope.year           = r.data.year\n\n    for publi in $scope.publicaciones\n      publi.contenido = $sce.trustAsHtml(publi.contenido)\n  , ()->\n    #alert('image not exist')\n    $scope.logoPath = $scope.logoPathDefault # set default image\n  )\n\n\n  $scope.credentials =\n    username: ''\n    password: ''\n    sexo: 'M'\n    nombres: ''\n    apellidos: ''\n    celular: ''\n    documento: ''\n\n\n  $scope.host = $location.host()\n\n  $scope.login = (credentials)->\n    $cookies.remove('xtoken')\n    Perfil.deleteUser()\n\n    AuthService.login_credentials(credentials).then((r)->\n\n      AuthService.verificar().then((r2)->\n        #if localStorage.getItem('logueando') == 'token_verificado'\n        localStorage.removeItem('logueando')\n      , (r3)->\n        console.log('Falló en Verificar', r3)\n      )\n      return\n    )\n\n\n  $scope.enviarPass = (correo_electronico)->\n    $http.post('::login/ver-pass', {email: correo_electronico, ruta: location.origin + location.pathname }).then((r)->\n      alert('Ahora, verifica tu correo');\n    , ()->\n      alert('Parece que el correo no está registrado.');\n    )\n\n\n  $scope.to_recuperando = ->\n    $scope.logueando = false\n    $scope.recuperando = true\n    $scope.registrando = false\n  $scope.to_registrando = ->\n    $scope.logueando = false\n    $scope.recuperando = false\n    $scope.registrando = true\n  $scope.to_logueando = ->\n    $scope.logueando = true\n    $scope.recuperando = false\n    $scope.registrando = false\n\n  return\n\n])\n\n\n\n\n.controller('ResetPasswordCtrl', ['$scope', '$state', '$stateParams', '$cookies', 'Perfil', 'App', '$http', 'toastr', ($scope, $state, $stateParams, $cookies, Perfil, App, $http, toastr)->\n\n  $scope.reseteando = false\n  $scope.username   = $stateParams.username\n  $scope.logoPath   = 'images/Logo_Colegio_Header.gif'\n\n  if $stateParams.numero < 10000\n    console.log 'Reseteo inválido, deja de intentarlo.'\n    $state.go 'login'\n\n\n  $scope.credentials =\n    password1: ''\n    password2: ''\n\n  $scope.reset = (credentials)->\n    $scope.reseteando = true\n\n    if credentials.password1 != credentials.password2\n      toastr.warning 'Las contraseñas no coinciden.'\n      $scope.reseteando = false\n      return\n    if credentials.password1.length < 4\n      toastr.warning 'Debe tener al menos 4 caracteres'\n      $scope.reseteando = false\n      return\n\n    $http.put('::login/reset-password', {password1: credentials.password1, numero: $stateParams.numero, username: $stateParams.username }).then((r)->\n      if r.data == 'Token inválido'\n        toastr.warning 'Token inválido'\n        $scope.reseteando = false\n      else\n        $state.go 'login'\n    , (r2)->\n      console.log('No se pudo resetear')\n      $scope.reseteando = false\n    )\n\n\n  return\n\n])\n"
  ]
}