{
  "version": 3,
  "file": "UsuariosCtrl.js",
  "sourceRoot": "",
  "sources": [
    "UsuariosCtrl.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "angular.module('myvcFrontApp')\n.controller('UsuariosCtrl', ['$scope', '$http', '$state', '$rootScope', 'AuthService', 'Perfil', 'App', '$uibModal', '$filter', 'toastr', ($scope, $http, $state, $rootScope, AuthService, Perfil, App, $modal, $filter, toastr) ->\n\n\tAuthService.verificar_acceso()\n\n\n\t$scope.editar = (row)->\n\t\t$state.go('panel.usuarios.editar', {usuario_id: row.user_id})\n\n\n\n\t$scope.crearUsuarioAdmin = ()->\n\t\tres = confirm('¿Seguro que desea crear un usuario Administrador?')\n\t\tif res\n\t\t\t$scope.creando = true\n\t\t\t$http.post('::users/crear-administrador').then((r)->\n\t\t\t\ttoastr.success('Creado con éxito')\n\t\t\t\t$scope.gridOptions.data.unshift(r.data.usuario);\n\t\t\t\t$scope.creando = false\n\t\t\t, ()->\n\t\t\t\ttoastr.error('No se pudo crear')\n\t\t\t\t$scope.creando = false\n\t\t\t)\n\n\n\t$scope.crearUsuarioPsicologo = ()->\n\t\tres = confirm('¿Seguro que desea crear un usuario Psicólogo?')\n\t\tif res\n\t\t\t$scope.creando = true\n\t\t\t$http.post('::users/crear-psicologo').then((r)->\n\t\t\t\ttoastr.success('Creado con éxito')\n\t\t\t\t$scope.gridOptions.data.unshift(r.data.usuario);\n\t\t\t\t$scope.creando = false\n\t\t\t, ()->\n\t\t\t\ttoastr.error('No se pudo crear')\n\t\t\t\t$scope.creando = false\n\t\t\t)\n\n\n\t$scope.crearUsuarioEnfermero = ()->\n\t\tres = confirm('¿Seguro que desea crear un usuario Enfermero?')\n\t\tif res\n\t\t\t$scope.creando = true\n\t\t\t$http.post('::users/crear-enfermero').then((r)->\n\t\t\t\ttoastr.success('Creado con éxito')\n\t\t\t\t$scope.gridOptions.data.unshift(r.data.usuario);\n\t\t\t\t$scope.creando = false\n\t\t\t, ()->\n\t\t\t\ttoastr.error('No se pudo crear')\n\t\t\t\t$scope.creando = false\n\t\t\t)\n\n\n\t$scope.eliminar = (row)->\n\n\t\tmodalInstance = $modal.open({\n\t\t\ttemplateUrl: '==usuarios/removeUsuario.tpl.html'\n\t\t\tcontroller: 'RemoveUsuarioCtrl'\n\t\t\tresolve:\n\t\t\t\tusuario: ()->\n\t\t\t\t\trow\n\t\t})\n\t\tmodalInstance.result.then( (user)->\n\t\t\t$scope.gridOptions.data = $filter('filter')($scope.gridOptions.data, {id: '!'+user.id})\n\t\t)\n\n\n\t$scope.resetPass = (row)->\n\n\t\tmodalInstance = $modal.open({\n\t\t\ttemplateUrl: '==usuarios/resetPass.tpl.html'\n\t\t\tcontroller: 'ResetPassCtrl'\n\t\t\tresolve:\n\t\t\t\tusuario: ()->\n\t\t\t\t\trow\n\t\t})\n\t\tmodalInstance.result.then( (user)->\n\t\t\t#console.log 'Resultado del modal: ', user\n\t\t)\n\n\n\t$scope.verRoles = (row)->\n\n\t\tmodalInstance = $modal.open({\n\t\t\ttemplateUrl: '==usuarios/verRoles.tpl.html'\n\t\t\tcontroller: 'VerRolesCtrl'\n\t\t\tresolve:\n\t\t\t\tusuario: ()->\n\t\t\t\t\trow\n\t\t\t\troles: ()->\n\t\t\t\t\t$http.get('::roles')\n\t\t})\n\t\tmodalInstance.result.then( (user)->\n\t\t\t#console.log 'Resultado del modal: ', user\n\t\t)\n\n\tbtGrid1 = '<a uib-tooltip=\"No cambies roles, consulta antes\" class=\"btn btn-default btn-xs shiny\" ng-click=\"grid.appScope.verRoles(row.entity)\">Roles</a>'\n\tbtGrid4 = '<a uib-tooltip=\"Resetear contraseña\" tooltip-placement=\"right\" class=\"btn btn-default btn-xs shiny\" ng-click=\"grid.appScope.resetPass(row.entity)\">Cambiar password</a>'\n\tbtGrid3 = '<a uib-tooltip=\"Eliminar usuario\" tooltip-placement=\"right\" ng-show=\"row.entity.is_superuser\" class=\"btn btn-danger btn-xs shiny\" ng-click=\"grid.appScope.eliminar(row.entity)\"><i class=\"fa fa-times\"></a>'\n\n\n\t$scope.gridOptions =\n\t\tshowGridFooter: true,\n\t\tenableSorting: true,\n\t\tenableFiltering: true,\n\t\tenableGridColumnMenu: false,\n\t\tenableCellEditOnFocus: true,\n\t\tcolumnDefs: [\n\t\t\t{ field: 'user_id', width: 70, enableFiltering: false, enableCellEdit: false }\n\t\t\t{ name: 'edicion', displayName:'Edición', width: 200, enableSorting: false, enableFiltering: false, cellTemplate: btGrid1 + btGrid4 + btGrid3, enableCellEdit: false}\n\t\t\t{ field: 'username', displayName: 'Usuario',\n\t\t\tfilter: {\n\t\t\t\tcondition: (searchTerm, cellValue, row)->\n\t\t\t\t\tentidad = row.entity\n\t\t\t\t\tif entidad.username\n\t\t\t\t\t\treturn (entidad.username.toLowerCase().indexOf(searchTerm.toLowerCase()) > -1)\n\t\t\t\t\treturn false\n\t\t\t}\n\t\t\tenableHiding: false}\n\n\t\t\t{ field: 'nombres', cellTemplate: '<div>{{row.entity.nombres + \" \" + row.entity.apellidos}}</div>',\n\t\t\tfilter: {\n\t\t\t\tcondition: (searchTerm, cellValue, row)->\n\t\t\t\t\tentidad = row.entity\n\t\t\t\t\tif entidad.nombres\n\t\t\t\t\t\treturn (entidad.nombres.toLowerCase().indexOf(searchTerm.toLowerCase()) > -1) or (entidad.apellidos.toLowerCase().indexOf(searchTerm.toLowerCase()) > -1)\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t{ field: 'sexo', width: 70 }\n\n\t\t\t{ field: 'roles', displayName: 'Roles', enableCellEdit: false, cellFilter: 'mapRoles',\n\t\t\tfilter: {\n\t\t\t\tcondition: (searchTerm, cellValue)->\n\t\t\t\t\tfound = $filter('filter')(cellValue, {name: searchTerm})\n\t\t\t\t\treturn found.length>0\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t\tmultiSelect: false,\n\t\t#filterOptions: $scope.filterOptions,\n\t\tonRegisterApi: ( gridApi ) ->\n\t\t\t$scope.gridApi = gridApi\n\t\t\tgridApi.edit.on.afterCellEdit($scope, (rowEntity, colDef, newValue, oldValue)->\n\n\t\t\t\tif newValue != oldValue\n\n\t\t\t\t\tif colDef.field == \"username\"\n\t\t\t\t\t\t$http.put('::perfiles/guardar-username/'+rowEntity.user_id, {username: rowEntity.username}).then((r)->\n\t\t\t\t\t\t\ttoastr.success 'Nombre de Usuario actualizado con éxito', 'Actualizado'\n\t\t\t\t\t\t, (r2)->\n\t\t\t\t\t\t\ttoastr.error 'Cambio no guardado', 'Error'\n\t\t\t\t\t\t)\n\t\t\t\t\telse\n\t\t\t\t\t\t$http.put('::perfiles/update/'+rowEntity.persona_id, rowEntity).then((r)->\n\t\t\t\t\t\t\ttoastr.success 'Usuario actualizado con éxito', 'Actualizado'\n\t\t\t\t\t\t, (r2)->\n\t\t\t\t\t\t\ttoastr.error 'Cambio no guardado', 'Error'\n\t\t\t\t\t\t)\n\t\t\t\t$scope.$apply()\n\t\t\t)\n\n\n\t$http.get('::perfiles/usuariosall?year_id=' + $scope.USER.year_id).then((data)->\n\t\t$scope.gridOptions.data = data.data;\n\t)\n\n\n\n\n\t$scope.crearTodosLosUsuarios = ()->\n\t\t$http.put('::perfiles/creartodoslosusuarios').then((r)->\n\t\t\ttoastr.success 'Usuarios creados con éxito'\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se pudo crear los usuarios', 'Problema'\n\t\t)\n\n])\n\n.filter('mapRoles', ['$filter', ($filter)->\n\n\treturn (input, grados)->\n\n\t\tif not input\n\t\t\treturn ''\n\t\telse\n\n\t\t\troles = []\n\n\t\t\tangular.forEach input, (value, key) ->\n\t\t\t\troles.push value.name\n\n\t\t\troles = roles.join()\n\t\t\treturn  roles\n])\n\n\n.controller('RemoveUsuarioCtrl', ['$scope', '$uibModalInstance', 'usuario', '$http', 'toastr', ($scope, $modalInstance, usuario, $http, toastr)->\n\t$scope.usuario = usuario\n\n\t$scope.ok = ()->\n\n\t\t$http.delete('::perfiles/destroy/'+usuario.user_id).then((r)->\n\t\t\ttoastr.success 'Usuario eliminado con éxito.', 'Eliminado'\n\t\t, (r2)->\n\t\t\ttoastr.warning 'No se pudo eliminar al usuario.', 'Problema'\n\t\t)\n\t\t$modalInstance.close(usuario)\n\n\t$scope.cancel = ()->\n\t\t$modalInstance.dismiss('cancel')\n\n])\n\n.controller('ResetPassCtrl', ['$scope', '$uibModalInstance', 'usuario', '$http', 'toastr', ($scope, $modalInstance, usuario, $http, toastr)->\n\t$scope.usuario = usuario\n\t$scope.newpassword = ''\n\t$scope.showPassword = false\n\n\t$scope.ok = ()->\n\n\t\t$http.put('::perfiles/reset-password/'+usuario.user_id, {password: $scope.newpassword}).then((r)->\n\t\t\ttoastr.success 'Contraseña cambiada.'\n\t\t, (r2)->\n\t\t\ttoastr.warning 'No se pudo cambiar contraseña.', 'Problema'\n\t\t)\n\t\t$modalInstance.close(usuario)\n\n\t$scope.cancel = ()->\n\t\t$modalInstance.dismiss('cancel')\n\n])\n\n\n.controller('VerRolesCtrl', ['$scope', '$uibModalInstance', 'usuario', 'roles', '$http', 'toastr', ($scope, $modalInstance, usuario, roles, $http, toastr)->\n\t$scope.usuario = usuario\n\t$scope.roles = roles.data\n\n\t$scope.datos = {selecteds: []}\n\n\t$scope.datos.selecteds = usuario.roles\n\n\n\t$scope.seleccionando = ($item, $model)->\n\n\t\t$http.put('::roles/addroletouser/'+$item.id, {user_id: usuario.user_id}).then((r)->\n\t\t\ttoastr.success 'Rol agregado con éxito.'\n\t\t, (r2)->\n\t\t\ttoastr.warning 'No se pudo agregar el rol al usuario.', 'Problema'\n\t\t)\n\n\t$scope.quitando = ($item, $model)->\n\n\t\t$http.put('::roles/removeroletouser/'+$item.id, {user_id: usuario.user_id}).then((r)->\n\t\t\ttoastr.success 'Rol quitado con éxito.'\n\t\t, (r2)->\n\t\t\ttoastr.warning 'No se pudo quitar el rol al usuario.', 'Problema'\n\t\t)\n\n\n\t$scope.ok = ()->\n\t\tusuario.roles = $scope.datos.selecteds\n\t\t$modalInstance.close(usuario)\n\n\t$scope.cancel = ()->\n\t\t$modalInstance.dismiss('cancel')\n\n])\n\n\n\n\n"
  ]
}