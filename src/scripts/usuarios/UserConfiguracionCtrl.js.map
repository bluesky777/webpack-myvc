{
  "version": 3,
  "file": "UserConfiguracionCtrl.js",
  "sourceRoot": "",
  "sources": [
    "UserConfiguracionCtrl.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "angular.module('myvcFrontApp')\n.controller('UserConfiguracionCtrl', ['$scope', '$http', '$state', 'toastr', 'AuthService', 'Perfil', 'App', 'perfilactual', ($scope, $http, $state, toastr, AuthService, Perfil, App, perfilactual) ->\n\n\tAuthService.verificar_acceso()\n\n\t$scope.data = {} # Para el popup del Datapicker\n\t$scope.comprobando = false\n\t$scope.mostrarErrorUsername = false\n\t$scope.mostrarErrorPassword = false\n\t$scope.canSaveUsername = false\n\t$scope.hasRoleOrPerm = AuthService.hasRoleOrPerm\n\t$scope.perfilPath = App.images+'perfil/'\n\n\t$scope.perfilactual  = perfilactual\n\n\t$scope.newusername = ''\n\t$scope.passantiguo = ''\n\t$scope.newpass = ''\n\t$scope.newpassverif = ''\n\t$scope.status = { passCambiado: false } # Para cerrar tab cuando se cambie el password\n\n\t$scope.nombresdeusuario = []\n\n\t$http.get('::perfiles/usernames').then((r)->\n\t\t$scope.nombresdeusuario = r.data\n\t, (r2)->\n\t\ttoastr.error 'No se trajeron los nombres de usuario'\n\t)\n\n\t$scope.dateOptions =\n\t\tformatYear: 'yyyy'\n\t\tallowInvalid: true\n\n\n\t$scope.guardarEmailRestore = (email_rest)->\n\t\t$http.put('::perfiles/guardar-mi-email-restore', {email_restore: email_rest}).then((r)->\n\t\t\ttoastr.success 'Email guardado con éxito'\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se trajeron los nombres de usuario'\n\t\t)\n\n\n\t$scope.$watch 'newusername', (oldv, newv)->\n\t\t#console.log 'oldv, newv', oldv, newv\n\n\t$scope.comprobarusername = (newusername)->\n\n\t\t$scope.canSaveUsername = false\n\t\t$scope.comprobando = true\n\n\t\tif newusername.username\n\t\t\tnewusername = newusername.username\n\t\tif newusername == $scope.perfilactual.username\n\t\t\ttoastr.warning 'Copia un nombre de usuario diferente al que ya tienes'\n\t\t\t$scope.comprobando = false\n\t\t\treturn\n\t\tif newusername == ''\n\t\t\ttoastr.warning 'Debes copiar un nombre de usuario.'\n\t\t\t$scope.comprobando = false\n\t\t\treturn\n\n\t\t$http.get('::perfiles/comprobarusername/'+newusername).then((r)->\n\t\t\tr = r.data\n\t\t\tif r[0].existe\n\t\t\t\ttoastr.warning 'Nombre de usuario ya en uso.'\n\t\t\t\t$scope.mostrarErrorUsername = true\n\t\t\telse\n\t\t\t\t$scope.mostrarErrorUsername = false\n\t\t\t\t$scope.canSaveUsername = true\n\t\t\t$scope.comprobando = false\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se trajeron los nombres de usuario'\n\t\t\t$scope.comprobando = false\n\t\t)\n\n\t$scope.guardar = ()->\n\t\t$scope.canSaveUsername = false\n\n\t\tdatos =\n\t\t\tnombres:\t$scope.perfilactual.nombres\n\t\t\tapellidos:\t$scope.perfilactual.apellidos\n\t\t\tsexo:\t\t$scope.perfilactual.sexo\n\t\t\tfecha_nac:\t$scope.perfilactual.fecha_nac\n\t\t\tcelular:\t$scope.perfilactual.celular\n\t\t\ttipo:\t\t$scope.perfilactual.tipo\n\t\t\temail_persona:\t$scope.perfilactual.email_persona\n\n\t\t$http.put('::perfiles/update/'+$scope.perfilactual.persona_id, datos).then((r)->\n\t\t\ttoastr.success 'Datos guardados'\n\t\t, (r2)->\n\t\t\ttoastr.error 'Datos NO guardados', 'Problema'\n\t\t\t$scope.canSaveUsername = true\n\t\t)\n\n\n\t$scope.solicitarCambios = ()->\n\t\t$scope.canSaveUsername = false\n\n\t\t$http.put('::ChangesAsked/solicitar-cambios', $scope.perfilactual).then((r)->\n\t\t\ttoastr.info 'Debes esperar que un administrador acepte cambios', 'Solicitud realizada', {timeOut: 8000}\n\t\t, (r2)->\n\t\t\ttoastr.error 'Datos NO guardados', 'Problema'\n\t\t\t$scope.canSaveUsername = true\n\t\t)\n\n\t$scope.CambiarUsername = (newusername)->\n\n\t\t$http.put('::perfiles/guardar-username/'+$scope.perfilactual.user_id, {'username':newusername}).then((r)->\n\t\t\ttoastr.success 'Nombre de usuario guardado'\n\t\t\tPerfil.User().username = newusername\n\t\t\t$scope.$emit 'cambianImgs', {username: newusername}\n\t\t, (r2)->\n\t\t\ttoastr.error 'Nombre de usuario NO guardado', 'Problema'\n\t\t)\n\n\t$scope.CambiarPass = (newpass, newpassverif, passantiguo)->\n\n\t\tif newpass not in [newpassverif]\n\t\t\ttoastr.warning 'Las contraseñas no coinciden'\n\t\t\treturn\n\t\tif newpass.length < 4\n\t\t\ttoastr.warning 'La contraseña debe tener mínimo 4 caracteres. Sin espacios ni Ñ ni tildes.'\n\t\t\treturn\n\n\t\t$scope.cambiandoPass = true # Bloqueamos el botón temporalmente\n\n\t\tdatos = {'password':newpassverif, 'oldpassword': passantiguo }\n\n\n\t\t$http.put('::perfiles/cambiarpassword/'+$scope.perfilactual.user_id, datos).then((r)->\n\t\t\ttoastr.success 'Contraseña cambiada.'\n\t\t\t$scope.status.passCambiado = false\n\t\t\t$scope.cambiandoPass = false\n\t\t, (r2)->\n\t\t\tr2 = r2.data\n\t\t\tif r2.$error\n\n\t\t\t\tif r2.error.message == 'Contraseña antigua es incorrecta'\n\t\t\t\t\ttoastr.warning r2.error.message\n\t\t\t\telse\n\t\t\t\t\ttoastr.error 'No se pudo cambiar la contraseña.'\n\t\t\telse\n\t\t\t\ttoastr.error 'No se pudo cambiar la contraseña.'\n\n\t\t\t$scope.cambiandoPass = false\n\t\t)\n\n\t$scope.CambiarCorreoRestore = ()->\n\n\t\tdatos = { 'email_restore': $scope.email_restore }\n\n\t\t$http.put('::perfiles/cambiaremailrestore/'+$scope.perfilactual.user_id, datos).then((r)->\n\t\t\ttoastr.success 'Contraseña cambiada.'\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se pudo cambiar la contraseña', 'Problema'\n\t\t)\n\n])\n\n"
  ]
}