{
  "version": 3,
  "file": "CopiarCtrl.js",
  "sourceRoot": "",
  "sources": [
    "CopiarCtrl.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "angular.module('myvcFrontApp')\n.controller('CopiarCtrl', ['$scope', '$uibModal', '$http', '$filter', '$rootScope', 'AuthService', 'toastr', 'App', 'YearsServ',\n\t($scope, $modal, $http, $filter, $rootScope, AuthService, toastr, App, YearsServ) ->\n\n\t\tAuthService.verificar_acceso()\n\n\t\t$scope.UNIDAD = $scope.USER.unidad_displayname\n\t\t$scope.GENERO_UNI = $scope.USER.genero_unidad\n\t\t$scope.SUBUNIDAD = $scope.USER.subunidad_displayname\n\t\t$scope.GENERO_SUB = $scope.USER.genero_subunidad\n\t\t$scope.UNIDADES = $scope.USER.unidades_displayname\n\t\t$scope.SUBUNIDADES = $scope.USER.subunidades_displayname\n\n\t\t$scope.views = App.views\n\n\t\t$scope.hasRoleOrPerm = AuthService.hasRoleOrPerm\n\n\t\t$scope.configuracion = {copiar_subunidades: true, copiar_notas: true}\n\t\t$scope.periodos = []\n\t\t$scope.resultado = ''\n\n\t\tprofe_id = $scope.USER.persona_id\n\n\t\t$scope.urlTplSubunidades = \"==unidades/subunidadespop.tpl.html\"\n\n\t\t###\n\t\tif $scope.hasRoleOrPerm('admin') == true\n\t\t\t$scope.profesores = []\n\t\t\t$scope.conprofes = true # Para indicar que el select de años se llene con la selección de un profe y no años traidos por get\n\n\t\t\t$http.get('::profesores/conyears').then((r)->\n\t\t\t\t$scope.profesores = r.data\n\t\t\t,(r)->\n\t\t\t\ttoastr.error 'No se pudo traer los profes con años', r\n\t\t\t)\n\n\t\telse\n\t\t\t$scope.conprofes = false\n\n\t\t\tYearsServ.getYears().then((r)->\n\t\t\t\t$scope.years_copy = r\n\t\t\t\t$scope.years_copy_to = r\n\t\t\t, (r)->\n\t\t\t\ttoastr.error 'No se pudo traer los años a copiar', r\n\t\t\t)\n\t\t###\n\n\t\t$scope.profesores = []\n\t\tif $scope.hasRoleOrPerm('admin') == true\n\t\t\t$scope.conprofes = true # Para indicar que el select de años se llene con la selección de un profe y no años traidos por get\n\n\n\t\t$http.get('::profesores/conyears').then((r)->\n\t\t\t$scope.profesores       = r.data\n\n\t\t\tif localStorage.asignatura_a_copiar\n\t\t\t\t$scope.asignatura_a_copiar = JSON.parse(localStorage.asignatura_a_copiar)\n\t\t\t\tdelete localStorage.asignatura_a_copiar\n\t\t\t\t\n\t\t\t\tif $scope.asignatura_a_copiar.profesor_id\n\n\t\t\t\t\tfor profe in $scope.profesores\n\t\t\t\t\t\tif profe.id == $scope.asignatura_a_copiar.profesor_id\n\t\t\t\t\t\t\t$scope.configuracion.profesor_from\t= profe\n\t\t\t\t\t\t\t$scope.years_copy             \t\t\t= profe.years\n\n\t\t\t\t\t\t\tfor year_search in $scope.years\n\t\t\t\t\t\t\t\tif year_search.id == $scope.asignatura_a_copiar.year_id\n\t\t\t\t\t\t\t\t\t$scope.configuracion.year_from  \t\t= year_search\n\t\t\t\t\t\t\t\t\t$scope.yearSelect(year_search)\n\n\t\t\t\t\t\t# Para el año destino\n\t\t\t\t\t\tif profe.id == profe_id\n\t\t\t\t\t\t\t$scope.years_copy_to          = profe.years\n\t\t\t\t\t\t\t$scope.configuracion.year_to  = profe.years[profe.years.length-1]\n\t\t\t\t\t\t\t$scope.yearToSelect(profe.years[profe.years.length-1])\n\n\t\t\t\telse\n\t\t\t\t\t$scope.set_year_copy_to()\n\n\t\t\telse\n\t\t\t\t$scope.set_year_copy_to()\n\n\n\t\t,(r)->\n\t\t\ttoastr.error 'No se pudo traer los profes con años', r\n\t\t)\n\n\t\t$scope.set_year_copy_to = ()->\n\t\t\t# Para el año destino\n\t\t\tfor profe in $scope.profesores\n\t\t\t\tif profe.id == profe_id\n\t\t\t\t\t$scope.years_copy_to          = profe.years\n\t\t\t\t\t$scope.configuracion.year_to  = profe.years[profe.years.length-1]\n\t\t\t\t\t$scope.yearToSelect(profe.years[profe.years.length-1])\n\n\t\t# ORIGEN\n\t\t$scope.profesorSelect = ($item, $model)->\n\t\t\t$scope.years_copy               = $item.years\n\t\t\t$scope.configuracion.year_from  = $scope.years_copy[$scope.years_copy.length-1]\n\n\t\t\tif $scope.configuracion.periodo_from\n\t\t\t\t$scope.configuracion.periodo_from = $scope.configuracion.year_from.periodos[0]\n\t\t\t\t$scope.periodoSelect($scope.configuracion.periodo_from)\n\t\t\telse\n\t\t\t\t$scope.periodos = $scope.configuracion.year_from.periodos\n\n\t\t$scope.yearSelect = ($item, $model)->\n\t\t\t$scope.periodos = $item.periodos\n\t\t\tif $scope.asignatura_a_copiar\n\t\t\t\tif $scope.asignatura_a_copiar.periodo_id\n\n\t\t\t\t\tfor periodo in $scope.periodos\n\t\t\t\t\t\tif periodo.id == $scope.asignatura_a_copiar.periodo_id\n\t\t\t\t\t\t\t$scope.configuracion.periodo_from = periodo\n\t\t\t\t\t\t\t$scope.periodoSelect(periodo)\n\n\n\t\t$scope.periodoSelect = ($item, $model)->\n\n\t\t\tif $scope.asignatura_a_copiar\n\t\t\t\tprofesor_id = $scope.asignatura_a_copiar.profesor_id\n\t\t\telse\n\t\t\t\tprofesor_id = $scope.configuracion.profesor_from.id\n\n\t\t\t$http.get('::asignaturas/list-asignaturas-year/'+profesor_id+'/'+$scope.configuracion.periodo_from.id).then((r)->\n\t\t\t\t$scope.asignaturas = r.data\n\n\t\t\t\tif $scope.asignatura_a_copiar\n\t\t\t\t\tif $scope.asignatura_a_copiar.asignatura_id\n\n\t\t\t\t\t\tfor asignatu in $scope.asignaturas\n\t\t\t\t\t\t\tif asignatu.asignatura_id == $scope.asignatura_a_copiar.asignatura_id\n\t\t\t\t\t\t\t\t$scope.configuracion.asignatura_from = asignatu\n\t\t\t\t\t\t\t\t$scope.asignaturaSelect asignatu\n\n\n\t\t\t\tif $scope.configuracion.asignatura_from\n\t\t\t\t\tasig_id = $scope.configuracion.asignatura_from.asignatura_id\n\t\t\t\t\tasig_found = $filter('filter')($scope.asignaturas, {asignatura_id: asig_id})[0]\n\t\t\t\t\t$scope.configuracion.asignatura_from = asig_found\n\n\t\t\t\t\t$scope.asignaturaSelect asig_found\n\n\t\t\t, (r2)->\n\t\t\t\ttoastr.error 'No se pudo traer las asignaturas origen'\n\t\t\t)\n\n\t\t$scope.asignaturaSelect = ($item, $model)->\n\t\t\tif $item and $item.unidades\n\t\t\t\tfor unidad in $item.unidades.items\n\t\t\t\t\tunidad.seleccionada = true\n\t\t\t\t$scope.unidades = $item.unidades\n\t\t\telse\n\t\t\t\t$scope.unidades = []\n\n\n\n\t\t# DESTINO\n\t\t$scope.profesorToSelect = ($item, $model)->\n\t\t\t$scope.years_copy_to = $item.years\n\n\t\t\tif $scope.configuracion.periodo_to\n\t\t\t\t$scope.configuracion.periodo_to = $scope.configuracion.year_to.periodos[0]\n\t\t\t\t$scope.periodoToSelect($scope.configuracion.periodo_to)\n\n\n\t\t$scope.yearToSelect = ($item, $model)->\n\t\t\t$scope.periodos_to = $item.periodos\n\n\n\n\t\t$scope.periodoToSelect = ($item, $model)->\n\n\t\t\tif $scope.conprofes == true\n\t\t\t\tprofe_id = $scope.configuracion.profesor_to.id\n\n\t\t\t$http.get('::asignaturas/list-asignaturas-year/'+profe_id+'/'+$scope.configuracion.periodo_to.id).then((r)->\n\t\t\t\tr = r.data\n\t\t\t\t$scope.asignaturas_to = r\n\n\t\t\t\tif $scope.configuracion.asignatura_to\n\t\t\t\t\tasig_id = $scope.configuracion.asignatura_to.asignatura_id\n\t\t\t\t\tasig_found = $filter('filter')($scope.asignaturas_to, {asignatura_id: asig_id})[0]\n\t\t\t\t\t$scope.configuracion.asignatura_to = asig_found\n\n\t\t\t\t\t$scope.asignaturaToSelect asig_found\n\n\t\t\t, (r2)->\n\t\t\t\ttoastr.error 'No se pudo traer las asignaturas destino, ', r2\n\t\t\t)\n\n\t\t$scope.asignaturaToSelect = ($item, $model)->\n\n\t\t\tif $item and $item.unidades\n\t\t\t\t$scope.unidades_to = $item.unidades\n\t\t\telse\n\t\t\t\t$scope.unidades_to = []\n\n\t\t\t$scope.activar_btn_copiar = true\n\n\n\n\t\t# COPIAR\n\t\t$scope.copiar = ()->\n\t\t\tif !$scope.activar_btn_copiar\n\t\t\t\treturn\n\n\t\t\t$scope.activar_btn_copiar = false\n\n\t\t\tunidades_a_copiar = $filter('filter')($scope.unidades.items, {seleccionada: true})\n\t\t\tunidades_ids = []\n\n\t\t\tangular.forEach unidades_a_copiar, (value, key) ->\n\t\t\t\tunidades_ids.push value.id\n\n\n\t\t\tdatos =\n\t\t\t\tcopiar_subunidades: \t$scope.configuracion.copiar_subunidades\n\t\t\t\tcopiar_notas:\t\t\t\t\t$scope.configuracion.copiar_notas\n\t\t\t\tasignatura_to_id:\t\t\t$scope.configuracion.asignatura_to.asignatura_id\n\t\t\t\tperiodo_from_id: \t\t\t$scope.configuracion.periodo_from.id\n\t\t\t\tperiodo_to_id: \t\t\t\t$scope.configuracion.periodo_to.id\n\t\t\t\tunidades_ids: \t\t\t\tunidades_ids\n\t\t\t\tgrupo_from_id:\t\t\t\t$scope.configuracion.asignatura_from.grupo_id\n\t\t\t\tgrupo_to_id:\t\t\t\t\t$scope.configuracion.asignatura_to.grupo_id\n\n\n\n\t\t\t$http.put('::periodos/copiar', datos).then((r)->\n\t\t\t\tr = r.data\n\t\t\t\ttoastr.success 'Copiado con éxito'\n\t\t\t\t$scope.activar_btn_copiar = true\n\t\t\t\t$scope.resultado = 'Unidades copiadas: ' + r.unidades_copiadas +\n\t\t\t\t\t\t\t\t\t' - Subunidades copiadas: ' + r.subunidades_copiadas +\n\t\t\t\t\t\t\t\t\t' - Notas copidas: ' + r.notas_copiadas\n\n\t\t\t\t\"\"\"\n\t\t\t\t$scope.unidades_to.items.push unidad_a_copiar for unidad_a_copiar in unidades_a_copiar\n\n\t\t\t\tif $scope.configuracion.asignatura_from.asignatura_id == $scope.configuracion.asignatura_to.asignatura_id and $scope.configuracion.periodo_from.id==$scope.configuracion.periodo_to.id\n\t\t\t\t\t$scope.unidades.items.push unidad_a_copiar for unidad_a_copiar in unidades_a_copiar\n\t\t\t\t\"\"\"\n\t\t\t\t$scope.unidades_to.items = r.unidades\n\n\t\t\t, (r2)->\n\t\t\t\ttoastr.error 'No se pudieron copiar los datos'\n\t\t\t\t$scope.activar_btn_copiar = true\n\t\t\t)\n\n\n\t]\n)\n"
  ]
}