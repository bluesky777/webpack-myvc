{
  "version": 3,
  "file": "UnidadesCtrl.js",
  "sourceRoot": "",
  "sources": [
    "UnidadesCtrl.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "angular.module('myvcFrontApp')\n.controller('UnidadesCtrl', ['$scope', '$uibModal', '$http', '$state', '$filter', 'AuthService', 'toastr', 'resolved_user', '$timeout', ($scope, $uibModal, $http, $state, $filter, AuthService, toastr, resolved_user, $timeout) ->\n\n\tAuthService.verificar_acceso()\n\n\n\t$scope.asignatura \t\t= {}\n\t$scope.asignatura_id \t= $state.params.asignatura_id\n\t$scope.datos \t\t\t    = {}\n\t$scope.UNIDAD \t\t\t  = $scope.USER.unidad_displayname\n\t$scope.GENERO_UNI \t\t= $scope.USER.genero_unidad\n\t$scope.SUBUNIDAD \t\t  = $scope.USER.subunidad_displayname\n\t$scope.GENERO_SUB \t\t= $scope.USER.genero_subunidad\n\t$scope.UNIDADES \t\t  = $scope.USER.unidades_displayname\n\t$scope.SUBUNIDADES \t\t= $scope.USER.subunidades_displayname\n\t$scope.hasRoleOrPerm  = AuthService.hasRoleOrPerm\n\n\t$scope.activar_crear_unidad = true\n\t$scope.unidades = []\n\n\n\t$http.put('::unidades/de-asignatura-periodo/' + $scope.asignatura_id + '/' + $scope.USER.periodo_id).then((r)->\n\t\t\n\t\t$scope.anios_pasados = r.data.anios_pasados\n\t\t$scope.mostrar_poco_anteriores = true\n\t\t\n\t\tif r.data.unidades.length > 0\n\t\t\tfor unidad in r.data.unidades\n\t\t\t\tunidad.anim_bloqueada = false\n\t\t\t\tunidad.subunidades = $filter('orderBy')(unidad.subunidades, 'orden')\n\t\t\t\t$scope.bloquear_animacion(unidad)\n\n\t\t\t\tif unidad\n\t\t\t\t\tfor subuni in unidad.subunidades\n\t\t\t\t\t\tsubuni.anim_bloqueada = false\n\t\t\t\t\t\t$scope.bloquear_animacion(subuni)\n\n\t\t\t$scope.unidades = r.data.unidades\n\t\t\t$scope.unidades = $filter('orderBy')($scope.unidades, 'orden')\n\n\t\t\t$scope.calcularPorcUnidades()\n\t, (r2)->\n\t\ttoastr.error 'No se pudo traer las ' + $scope.UNIDADES, 'Problemas'\n\t)\n\n\t$http.get('::asignaturas/show/' + $scope.asignatura_id).then((r)->\n\t\tr = r.data\n\t\t$scope.asignatura = r\n\t\t$scope.inicializado = true\n\t\t$scope.profesor_id \t= r.profesor_id\n\t\tif not r\n\t\t\t$scope.no_asignatura = true\n\t, (r2)->\n\t\ttoastr.error 'No se pudo traer los datos de la asignatura'\n\t\t$scope.no_asignatura = true\n\t)\n\n\n\n\t$scope.mostrarUnidadesEliminadas = ()->\n\t\tif $scope.mostrando_unidades_eliminadas\n\t\t\t$scope.mostrando_unidades_eliminadas = false\n\t\telse\n\t\t\t$http.put('::unidades/eliminadas/' + $scope.asignatura_id).then((r)->\n\t\t\t\tr = r.data\n\t\t\t\t$scope.unidades_eliminadas    = r.unidades_eliminadas\n\t\t\t\t$scope.subunidades_eliminadas = r.subunidades_eliminadas\n\t\t\t\t$scope.mostrando_unidades_eliminadas = true\n\t\t\t, (r2)->\n\t\t\t\t$scope.mostrando_unidades_eliminadas = true\n\t\t\t\ttoastr.error 'No se pudo traer las unidades eliminadas'\n\t\t\t)\n\n\n\t$scope.restaurarUnidad = (unidad)->\n\t\tif !unidad.restaurando\n\t\t\tunidad.restaurando = true\n\t\t\t$http.put('::unidades/restore/'+unidad.id).then((r)->\n\n\t\t\t\t$scope.unidades.push unidad\n\t\t\t\t$scope.calcularPorcUnidades()\n\t\t\t\t$timeout(()->\n\t\t\t\t\t$scope.onSortUnidades(undefined, $scope.unidades)\n\t\t\t\t, 100)\n\t\t\t\ttoastr.success 'Listo.'\n\t\t\t, (r2)->\n\t\t\t\tunidad.restaurando = false\n\t\t\t\ttoastr.error 'Error restaurando', 'Problema'\n\t\t\t)\n\n\n\n\n\t$scope.mostrarSubunidadesEliminadas = ()->\n\t\tif $scope.mostrando_subunidades_eliminadas\n\t\t\t$scope.mostrando_subunidades_eliminadas = false\n\t\telse\n\t\t\t$http.put('::subunidades/eliminadas/' + $scope.asignatura_id).then((r)->\n\t\t\t\tr = r.data\n\t\t\t\t$scope.subunidades_eliminadas = r.subunidades\n\t\t\t\t$scope.mostrando_subunidades_eliminadas = true\n\t\t\t, (r2)->\n\t\t\t\t$scope.mostrando_subunidades_eliminadas = true\n\t\t\t\ttoastr.error 'No se pudo traer las subunidades eliminadas'\n\t\t\t)\n\n\n\t$scope.restaurarSubunidad = (subunidad)->\n\t\tif !subunidad.restaurando\n\t\t\tsubunidad.restaurando = true\n\t\t\t$http.put('::subunidades/restore/'+subunidad.id).then((r)->\n\t\t\t\ttoastr.success 'Listo. Recargue para ver los cambios'\n\t\t\t, (r2)->\n\t\t\t\tsubunidad.restaurando = false\n\t\t\t\ttoastr.error 'Error restaurando', 'Problema'\n\t\t\t)\n\n\n\n\n\n\t$scope.copiarUnidade = ()->\n\t\t$scope.asignatura.periodo_id      = $scope.USER.periodo_id\n\t\t$scope.asignatura.year_id         = $scope.USER.year_id\n\t\t\n\t\tmodalInstance = $uibModal.open({\n\t\t\ttemplateUrl: '==unidades/copiarUnidadModal.tpl.html'\n\t\t\tcontroller: 'CopiarUnidadModalCtrl'\n\t\t\tresolve:\n\t\t\t\tUSER: ()->\n\t\t\t\t\t$scope.USER\n\t\t\t\tasignatura: ()->\n\t\t\t\t\t$scope.asignatura\n\t\t})\n\t\tmodalInstance.result.then( (alum)->\n\t\t\t$scope.gridOptions.data = $filter('filter')($scope.gridOptions.data, {alumno_id: '!'+alum.alumno_id})\n\t\t, ()->\n\t\t\t# nada\n\t\t)\n\n\n\n\t$scope.copiarUnidades = ()->\n\t\t$scope.asignatura.periodo_id      = $scope.USER.periodo_id\n\t\t$scope.asignatura.year_id         = $scope.USER.year_id\n\t\tlocalStorage.asignatura_a_copiar  = JSON.stringify($scope.asignatura)\n\t\t$state.go('panel.copiar')\n\n\n\n\t$scope.calcularPorcUnidades = ()->\n\t\tsum = 0\n\t\tangular.forEach $scope.unidades, (unidad, key) ->\n\t\t\tsum = sum + unidad.porcentaje\n\n\t\t\tsubsum = 0\n\t\t\tangular.forEach unidad.subunidades, (subunidad, key) ->\n\t\t\t\tsubsum = subsum + subunidad.porcentaje\n\n\t\t\tunidad.subunidades.porc_subunidades = subsum\n\t\t\tunidad.subunidades.unidad_id = unidad.id # El ordenador me borra esta propiedad a cada rato, por eso la pongo aquí\n\n\t\t$scope.unidades.porc_unidades \t= sum\n\n\n\n\n\t$scope.crearUnidad = ()->\n\n\t\t$scope.activar_crear_unidad     = false\n\n\t\t$scope.newunidad.asignatura_id = $scope.asignatura.asignatura_id\n\n\t\t$http.post('::unidades', $scope.newunidad).then((r)->\n\t\t\tr = r.data\n\t\t\tr.subunidades = []\n\t\t\tr.obligatoria = 0\n\t\t\tr.anim_bloqueada = false\n\t\t\t$scope.unidades.push r\n\n\t\t\tcreado = 'creado'\n\t\t\tif $scope.GENERO_UNI == 'F'\n\t\t\t\tcreado = 'creada'\n\n\t\t\ttoastr.success $scope.UNIDAD + ' ' + creado + '. Ahora agrégale ' + $scope.SUBUNIDADES\n\t\t\t$scope.newunidad.definicion = ''\n\t\t\t$scope.calcularPorcUnidades()\n\t\t\t$scope.activar_crear_unidad = true\n\t\t\t$scope.bloquear_animacion()\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se pudo crear la unidad', 'Problemas'\n\t\t\t$scope.activar_crear_unidad = true\n\t\t)\n\n\n\n\t$scope.actualizarUnidad = (unidad)->\n\n\t\tdatos =\n\t\t\tdefinicion: \t\tunidad.definicion\n\t\t\tporcentaje: \t\tunidad.porcentaje\n\t\t\tasignatura_id: \tunidad.asignatura_id\n\t\t\tperiodo_id: \t\t$scope.USER.periodo_id\n\t\t\tnum_periodo: \t\t$scope.USER.numero_periodo\n\n\t\t$http.put('::unidades/update/' + unidad.id, datos).then((r)->\n\n\t\t\tactualizado = 'actualizado'\n\t\t\tif $scope.GENERO_UNI == 'F'\n\t\t\t\tactualizado = 'actualizada'\n\n\t\t\ttoastr.success $scope.UNIDAD + ' ' + actualizado + ' con éxito.'\n\t\t\tunidad.editando = false\n\t\t\t$scope.calcularPorcUnidades()\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se pudo actualizar ' + $scope.UNIDAD, 'Problemas'\n\t\t)\n\n\n\n\t$scope.removeUnidad = (unidad)->\n\n\t\tmodalInstance = $uibModal.open({\n\t\t\ttemplateUrl: '==unidades/removeUnidad.tpl.html'\n\t\t\tcontroller: 'RemoveUnidadCtrl'\n\t\t\tresolve:\n\t\t\t\tunidad: ()->\n\t\t\t\t\tunidad\n\t\t\t\tUSER: ()->\n\t\t\t\t\t$scope.USER\n\t\t})\n\t\tmodalInstance.result.then( (unidad)->\n\t\t\t$scope.unidades = $filter('filter')($scope.unidades, {id: '!'+unidad.id})\n\t\t\t$scope.calcularPorcUnidades()\n\t\t\t$timeout(()->\n\t\t\t\t$scope.onSortUnidades(undefined, $scope.unidades)\n\t\t\t, 100)\n\t\t)\n\n\n\n\t$scope.onSortUnidades = ($item, $partFrom, $partTo, $indexFrom, $indexTo)->\n\n\t\tsortHash = []\n\n\t\tfor unidad, index in $partFrom\n\t\t\tunidad.orden = index\n\n\t\t\thashEntry = {}\n\t\t\thashEntry[\"\" + unidad.id] = index\n\t\t\tsortHash.push(hashEntry)\n\n\t\tdatos =\n\t\t\tsortHash: sortHash\n\n\t\t$http.put('::unidades/update-orden', datos).then((r)->\n\t\t\treturn true\n\t\t, (r2)->\n\t\t\ttoastr.warning 'No se pudo ordenar', 'Problema'\n\t\t\treturn false;\n\t\t)\n\n\t\t$scope.calcularPorcUnidades()\n\n\n\t$scope.onStartSortUnidades= ($item, $part, $index, $helper)->\n\t\tconsole.log $item, $part\n\n\t$scope.bloquear_animacion = (elemento)->\n\t\tif !elemento\n\t\t\treturn\n\t\t$timeout(()->\n\t\t\telemento.anim_bloqueada   = true\n\t\t, 2000)\n\n\n\t$scope.activar_crear_subunidad = true\n\n\n\t$scope.onSortSubunidades = ($item, $partFrom, $partTo, $indexFrom, $indexTo)->\n\n\t\tif $partFrom == $partTo\n\n\t\t\tsortHash = []\n\n\t\t\tfor subunidad, index in $partFrom #subunidades\n\t\t\t\tsubunidad.orden = index\n\n\t\t\t\thashEntry = {}\n\t\t\t\thashEntry[\"\" + subunidad.id] = index\n\t\t\t\tsortHash.push(hashEntry)\n\n\t\t\tdatos =\n\t\t\t\tsortHash: sortHash\n\n\t\t\t$http.put('::subunidades/update-orden', datos).then((r)->\n\t\t\t\treturn true\n\t\t\t, (r2)->\n\t\t\t\ttoastr.warning 'No se pudo ordenar', 'Problema'\n\t\t\t\treturn false;\n\t\t\t)\n\n\t\telse\n\n\t\t\tsortHash1 \t= []\n\t\t\tsortHash2 \t= []\n\t\t\tdatos \t\t= {}\n\n\t\t\t# Actualizamos la primera parte\n\t\t\tfor subunidad, index in $partFrom #subunidades\n\t\t\t\tsubunidad.orden = index\n\n\t\t\t\thashEntry = {}\n\t\t\t\thashEntry[\"\" + subunidad.id] = index\n\t\t\t\tsortHash1.push(hashEntry)\n\n\n\t\t\tif sortHash1.length > 0\n\t\t\t\tdatos.unidad1_id \t= $partFrom.unidad_id\n\t\t\t\tdatos.sortHash1 \t= sortHash1\n\n\t\t\t# Actualizamos la Segunda parte\n\t\t\tfor subunidad, index in $partTo\n\t\t\t\tsubunidad.orden = index\n\n\t\t\t\thashEntry = {}\n\t\t\t\thashEntry[\"\" + subunidad.id] = index\n\t\t\t\tsortHash2.push(hashEntry)\n\n\n\t\t\tif sortHash1.length > 0\n\t\t\t\tdatos.unidad2_id \t= $partTo.unidad_id\n\t\t\t\tdatos.sortHash2 \t= sortHash2\n\n\t\t\t$http.put('::subunidades/update-orden-varias', datos).then((r)->\n\t\t\t\treturn true\n\t\t\t, (r2)->\n\t\t\t\ttoastr.warning 'No se pudo ordenar', 'Problema'\n\t\t\t\treturn false;\n\t\t\t)\n\n\t\t$scope.calcularPorcUnidades()\n\n\n\n\n\n\n\n\t$scope.addSubunidad = (unidad)->\n\n\t\t$scope.activar_crear_subunidad  = false\n\n\t\tif !unidad.newsubunidad\n\t\t\ttoastr.warning 'Aún debes escribir.'\n\t\t\t$scope.activar_crear_subunidad  = true\n\t\t\treturn\n\n\t\tif !unidad.newsubunidad.definicion\n\t\t\ttoastr.warning 'Debes escribir la difinición.'\n\t\t\t$scope.activar_crear_subunidad  = true\n\t\t\treturn\n\n\t\tif !unidad.newsubunidad.porcentaje\n\t\t\tunidad.newsubunidad.porcentaje  = 0\n\n\t\tif !unidad.newsubunidad.nota_default\n\t\t\tunidad.newsubunidad.nota_default  = 0\n\n\t\tunidad.newsubunidad.unidad_id   = unidad.id\n\t\tunidad.newsubunidad.definicion  = unidad.newsubunidad.definicion.trim()\n\n\t\t$http.post('::subunidades', unidad.newsubunidad).then((r)->\n\t\t\tr.data.anim_bloqueada = false\n\t\t\tunidad.subunidades.push r.data\n\n\t\t\tcreado = 'creado'\n\t\t\tif $scope.GENERO_SUB == 'F'\n\t\t\t\tcreado = 'creada'\n\n\t\t\ttoastr.success $scope.SUBUNIDAD + ' ' + creado + ' con éxito.'\n\t\t\tunidad.newsubunidad.definicion = ''\n\t\t\t$scope.calcularPorcUnidades()\n\t\t\t$scope.activar_crear_subunidad = true\n\t\t\t$scope.bloquear_animacion(r.data)\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se pudo crear  ' + (if $scope.GENERO_UNI==\"M\" then 'el' else 'la') + scope.SUBUNIDAD, 'Problemas'\n\t\t\t$scope.activar_crear_subunidad = true\n\t\t)\n\n\t$scope.ir_a_notas = (datos)->\n\t\t$state.go 'panel.notas', datos\n\n\t$scope.actualizarSubunidad = (subunidad, unidad)->\n\n\t\tdatos =\n\t\t\tdefinicion: subunidad.definicion\n\t\t\tporcentaje: subunidad.porcentaje\n\t\t\tnota_default: subunidad.nota_default\n\t\t\torden: subunidad.orden\n\t\t\tasignatura_id: \tunidad.asignatura_id\n\t\t\tperiodo_id: \t\t$scope.USER.periodo_id\n\t\t\tnum_periodo: \t\t$scope.USER.numero_periodo\n\n\t\t$http.put('::subunidades/update/' + subunidad.id, datos).then((r)->\n\n\t\t\tactualizado = 'actualizado'\n\t\t\tif $scope.GENERO_SUB == 'F'\n\t\t\t\tactualizado = 'actualizada'\n\n\t\t\ttoastr.success $scope.SUBUNIDAD + ' ' + actualizado + ' con éxito.'\n\t\t\tsubunidad.editando = false\n\n\t\t\t$scope.calcularPorcUnidades()\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se pudo actualizar ' + $scope.SUBUNIDAD, 'Problemas'\n\t\t)\n\n\t$scope.removeSubunidad = (unidad, subunidad)->\n\n\t\tmodalInstance = $uibModal.open({\n\t\t\ttemplateUrl: '==unidades/removeSubunidad.tpl.html'\n\t\t\tcontroller: 'RemoveSubunidadCtrl'\n\t\t\tresolve:\n\t\t\t\tsubunidad: ()->\n\t\t\t\t\tsubunidad\n\t\t\t\tunidad: ()->\n\t\t\t\t\tunidad\n\t\t\t\tUSER: ()->\n\t\t\t\t\t$scope.USER\n\t\t})\n\t\tmodalInstance.result.then( (unid)->\n\t\t\tunidad.subunidades = $filter('filter')(unidad.subunidades, {id: '!'+subunidad.id})\n\t\t\t$scope.calcularPorcUnidades()\n\t\t\t$timeout(()->\n\t\t\t\t$scope.onSortSubunidades(undefined, undefined, unidad.subunidades)\n\t\t\t, 100)\n\t\t)\n\n\n\n])\n\n.controller('RemoveUnidadCtrl', ['$scope', '$uibModalInstance', 'unidad', '$http', 'toastr', 'USER', ($scope, $modalInstance, unidad, $http, toastr, USER)->\n\t$scope.unidad = unidad\n\n\t$scope.ok = ()->\n\n\t\tdatos =\n\t\t\tasignatura_id: \tunidad.asignatura_id\n\t\t\tperiodo_id: \t\tUSER.periodo_id\n\t\t\tnum_periodo: \t\tUSER.numero_periodo\n\n\n\t\t$http.delete('::unidades/destroy/'+unidad.id, {params: datos}).then((r)->\n\t\t\ttoastr.success 'Unidad eliminada con éxito.', 'Eliminada'\n\t\t, (r2)->\n\t\t\ttoastr.warning 'No se pudo eliminar la unidad.', 'Problema'\n\t\t)\n\t\t$modalInstance.close(unidad)\n\n\t$scope.cancel = ()->\n\t\t$modalInstance.dismiss('cancel')\n\n])\n\n.controller('RemoveSubunidadCtrl', ['$scope', '$uibModalInstance', 'subunidad', 'unidad', 'USER', '$http', 'toastr', ($scope, $modalInstance, subunidad, unidad, USER, $http, toastr)->\n\t$scope.subunidad = subunidad\n\n\t$scope.ok = ()->\n\n\t\tdatos =\n\t\t\tasignatura_id: \tunidad.asignatura_id\n\t\t\tperiodo_id: \t\tUSER.periodo_id\n\t\t\tnum_periodo: \t\tUSER.numero_periodo\n\n\t\t$http.delete('::subunidades/destroy/'+subunidad.id, {params: datos}).then((r)->\n\t\t\ttoastr.success 'Subunidad eliminada con éxito.', 'Eliminada'\n\t\t, (r2)->\n\t\t\ttoastr.warning 'No se pudo eliminar la subunidad.', 'Problema'\n\t\t)\n\t\t$modalInstance.close(subunidad)\n\n\t$scope.cancel = ()->\n\t\t$modalInstance.dismiss('cancel')\n\n])\n\n\n.controller('CopiarUnidadModalCtrl', ['$scope', '$state', '$uibModalInstance', 'asignatura', 'USER', '$http', 'toastr', 'App', '$filter', ($scope, $state, $modalInstance, asignatura, USER, $http, toastr, App, $filter)->\n\t$scope.asignatura \t\t= asignatura\n\t$scope.UNIDAD\t\t\t= USER.unidad_displayname\n\t$scope.GENERO_UNI \t\t= USER.genero_unidad\n\t$scope.SUBUNIDAD\t\t= USER.subunidad_displayname\n\t$scope.GENERO_SUB \t\t= USER.genero_subunidad\n\t$scope.UNIDADES\t\t\t= USER.unidades_displayname\n\t$scope.SUBUNIDADES \t\t= USER.subunidades_displayname\n\t$scope.configuracion \t= {copiar_subunidades: true, copiar_notas: true}\n\t$scope.views \t\t\t= App.views\n\t\n\t$http.get('::profesores/conyears').then((r)->\n\t\t$scope.profesores = r.data\n\t,(r)->\n\t\ttoastr.error 'No se pudo traer los profes con años', r\n\t)\n\t\n\t\n\t\n\t# ORIGEN\n\t$scope.profesorSelect = ($item, $model)->\n\t\t$scope.years_copy               = $item.years\n\t\t$scope.configuracion.year_from  = $scope.years_copy[$scope.years_copy.length-1]\n\n\t\tif $scope.configuracion.periodo_from\n\t\t\t$scope.configuracion.periodo_from = $scope.configuracion.year_from.periodos[0]\n\t\t\t$scope.periodoSelect($scope.configuracion.periodo_from)\n\t\telse\n\t\t\t$scope.periodos = $scope.configuracion.year_from.periodos\n\n\t$scope.yearSelect = ($item, $model)->\n\t\t$scope.periodos = $item.periodos\n\t\tif $scope.asignatura_a_copiar\n\t\t\tif $scope.asignatura_a_copiar.periodo_id\n\n\t\t\t\tfor periodo in $scope.periodos\n\t\t\t\t\tif periodo.id == $scope.asignatura_a_copiar.periodo_id\n\t\t\t\t\t\t$scope.configuracion.periodo_from = periodo\n\t\t\t\t\t\t$scope.periodoSelect(periodo)\n\n\n\t$scope.periodoSelect = ($item, $model)->\n\n\t\tif $scope.asignatura_a_copiar\n\t\t\tprofesor_id = $scope.asignatura_a_copiar.profesor_id\n\t\telse\n\t\t\tprofesor_id = $scope.configuracion.profesor_from.id\n\n\t\t$http.get('::asignaturas/list-asignaturas-year/'+profesor_id+'/'+$scope.configuracion.periodo_from.id).then((r)->\n\t\t\t$scope.asignaturas = r.data\n\n\t\t\tif $scope.asignatura_a_copiar\n\t\t\t\tif $scope.asignatura_a_copiar.asignatura_id\n\n\t\t\t\t\tfor asignatu in $scope.asignaturas\n\t\t\t\t\t\tif asignatu.asignatura_id == $scope.asignatura_a_copiar.asignatura_id\n\t\t\t\t\t\t\t$scope.configuracion.asignatura_from = asignatu\n\t\t\t\t\t\t\t$scope.asignaturaSelect asignatu\n\n\n\t\t\tif $scope.configuracion.asignatura_from\n\t\t\t\tasig_id = $scope.configuracion.asignatura_from.asignatura_id\n\t\t\t\tasig_found = $filter('filter')($scope.asignaturas, {asignatura_id: asig_id})[0]\n\t\t\t\t$scope.configuracion.asignatura_from = asig_found\n\n\t\t\t\t$scope.asignaturaSelect asig_found\n\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se pudo traer las asignaturas origen'\n\t\t)\n\n\t$scope.asignaturaSelect = ($item, $model)->\n\t\tif $item and $item.unidades\n\t\t\tfor unidad in $item.unidades.items\n\t\t\t\tunidad.seleccionada = true\n\t\t\t$scope.unidades = $item.unidades\n\t\telse\n\t\t\t$scope.unidades = []\n\t\t\n\t\t$scope.activar_btn_copiar = true\n\t\t\n\n\n\t# COPIAR\n\t$scope.copiar = ()->\n\t\tif !$scope.activar_btn_copiar\n\t\t\treturn\n\n\t\t$scope.activar_btn_copiar = false\n\n\t\tunidades_a_copiar = $filter('filter')($scope.unidades.items, {seleccionada: true})\n\t\tunidades_ids = []\n\n\t\tangular.forEach unidades_a_copiar, (value, key) ->\n\t\t\tunidades_ids.push value.id\n\n\n\t\tdatos =\n\t\t\tcopiar_subunidades: \t\t$scope.configuracion.copiar_subunidades\n\t\t\tcopiar_notas:\t\t\t\t$scope.configuracion.copiar_notas\n\t\t\tasignatura_to_id:\t\t\tasignatura.asignatura_id\n\t\t\tperiodo_from_id: \t\t\t$scope.configuracion.periodo_from.id\n\t\t\tperiodo_to_id: \t\t\t\tasignatura.periodo_id\n\t\t\tunidades_ids: \t\t\t\tunidades_ids\n\t\t\tgrupo_from_id:\t\t\t\t$scope.configuracion.asignatura_from.grupo_id\n\t\t\tgrupo_to_id:\t\t\t\tasignatura.grupo_id\n\n\n\n\t\t$http.put('::periodos/copiar', datos).then((r)->\n\t\t\tr = r.data\n\t\t\ttoastr.success 'Copiado con éxito'\n\t\t\t$scope.activar_btn_copiar = true\n\t\t\t$scope.resultado = 'Unidades copiadas: ' + r.unidades_copiadas +\n\t\t\t\t\t\t\t\t' - Subunidades copiadas: ' + r.subunidades_copiadas +\n\t\t\t\t\t\t\t\t' - Notas copidas: ' + r.notas_copiadas\n\n\t\t\t$state.go 'panel.unidades', {asignatura_id: asignatura.asignatura_id}, {reload: true}\n\n\n\t\t, (r2)->\n\t\t\ttoastr.error 'No se pudieron copiar los datos'\n\t\t\t$scope.activar_btn_copiar = true\n\t\t)\n\n\t\n\n\t$scope.ok = ()->\n\n\t\t$modalInstance.close(subunidad)\n\n\t$scope.cancel = ()->\n\t\t$modalInstance.dismiss('cancel')\n\n])\n\n\n\n\n\n"
  ]
}